<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Land Optimization - API Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .status-card h3 {
            color: #333;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .status-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .status-card.online .value {
            color: #10b981;
        }

        .status-card.error .value {
            color: #ef4444;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        button.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .result {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #333;
        }

        .success {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .warning {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .quick-link {
            padding: 10px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            transition: background 0.3s;
        }

        .quick-link:hover {
            background: #764ba2;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        #floorPlan {
            max-width: 100%;
            overflow: hidden;
        }

        #floorPlan img {
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè† AI Land Optimization Dashboard</h1>
            <p>Test and visualize your land optimization API</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-card online">
                <h3>API Status</h3>
                <div class="value" id="apiStatus">‚óè</div>
            </div>
            <div class="status-card">
                <h3>Server</h3>
                <div class="value" style="font-size: 1.2em;">localhost:8000</div>
            </div>
            <div class="status-card">
                <h3>Version</h3>
                <div class="value" style="font-size: 1.5em;" id="apiVersion">-</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Validation Section -->
            <div class="card">
                <h2>üîç Validate Land</h2>
                <form id="validateForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Length (m)</label>
                            <input type="number" id="length" value="15" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>Width (m)</label>
                            <input type="number" id="width" value="10" min="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Bedrooms</label>
                            <input type="number" id="bedrooms" value="3" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label>Toilets</label>
                            <input type="number" id="toilets" value="2" min="1" max="5" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Living Room</label>
                            <select id="living_room">
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Dining Room</label>
                            <select id="dining_room">
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Front Direction</label>
                            <select id="front_direction">
                                <option value="north" selected>North</option>
                                <option value="south">South</option>
                                <option value="east">East</option>
                                <option value="west">West</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Road Side</label>
                            <select id="road_side">
                                <option value="north" selected>North</option>
                                <option value="south">South</option>
                                <option value="east">East</option>
                                <option value="west">West</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Garden Area (sqm)</label>
                            <input type="number" id="garden_area" value="20" min="0">
                        </div>
                        <div class="form-group">
                            <label>Parking Spaces</label>
                            <input type="number" id="parking_spaces" value="1" min="0" max="5">
                        </div>
                    </div>
                    <button type="submit">Validate Land Parameters</button>
                </form>
                <div id="validateResult" class="result" style="display: none;"></div>
            </div>

            <!-- Optimization Section -->
            <div class="card">
                <h2>üß¨ Run Optimization</h2>
                <div class="form-group">
                    <label>Generations</label>
                    <input type="number" id="generations" value="20" min="5" max="200">
                </div>
                <div class="form-group">
                    <label>Population Size</label>
                    <input type="number" id="population_size" value="30" min="10" max="100">
                </div>
                <button onclick="runOptimization()" class="secondary">üöÄ Optimize Layout</button>
                <div id="optimizeResult" class="result" style="display: none;"></div>
                <div id="floorPlan" style="margin-top: 15px;"></div>
            </div>

            <!-- History Section -->
            <div class="card">
                <h2>üìä Optimization History</h2>
                <button onclick="loadHistory()">Load Recent Results</button>
                <button onclick="loadBest()" class="secondary">Load Best Results</button>
                <div id="historyResult" class="result" style="display: none;"></div>
            </div>

            <!-- Quick Links -->
            <div class="card">
                <h2>üîó Quick Links</h2>
                <div class="quick-links">
                    <a href="http://localhost:8000/docs" target="_blank" class="quick-link">üìñ Swagger UI</a>
                    <a href="http://localhost:8000/redoc" target="_blank" class="quick-link">üìò ReDoc</a>
                    <a href="http://localhost:8000/health" target="_blank" class="quick-link">‚ù§Ô∏è Health</a>
                    <a href="http://localhost:8000/api/v1/info" target="_blank" class="quick-link">‚ÑπÔ∏è System Info</a>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                    <h3 style="margin-bottom: 10px;">üì¶ Postman Collection</h3>
                    <p style="margin-bottom: 10px; font-size: 0.9em;">Import the Postman collection file:</p>
                    <code style="background: white; padding: 5px 10px; border-radius: 4px; display: block; word-break: break-all;">
                        AI_Land_Optimization_API.postman_collection.json
                    </code>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        // Check API status on load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                document.getElementById('apiStatus').textContent = '‚óè';
                document.getElementById('apiVersion').textContent = data.version || '1.0.0';
            } catch (error) {
                document.getElementById('apiStatus').textContent = '‚óè';
                document.getElementById('apiStatus').parentElement.classList.add('error');
                document.getElementById('apiStatus').parentElement.classList.remove('online');
            }
        });

        // Validate form
        document.getElementById('validateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                length: parseFloat(document.getElementById('length').value),
                width: parseFloat(document.getElementById('width').value),
                bedrooms: parseInt(document.getElementById('bedrooms').value),
                toilets: parseInt(document.getElementById('toilets').value),
                kitchen: 1,
                living_room: parseInt(document.getElementById('living_room').value),
                dining_room: parseInt(document.getElementById('dining_room').value),
                garden_area: parseFloat(document.getElementById('garden_area').value),
                parking_spaces: parseInt(document.getElementById('parking_spaces').value),
                balcony: false,
                front_direction: document.getElementById('front_direction').value,
                road_side: document.getElementById('road_side').value
            };

            showLoading('validateResult');

            try {
                const response = await fetch(`${API_BASE}/api/v1/optimization/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('validateResult', result, response.ok);
            } catch (error) {
                showError('validateResult', error.message);
            }
        });

        // Run optimization
        async function runOptimization() {
            const landData = {
                length: parseFloat(document.getElementById('length').value),
                width: parseFloat(document.getElementById('width').value),
                bedrooms: parseInt(document.getElementById('bedrooms').value),
                toilets: parseInt(document.getElementById('toilets').value),
                kitchen: 1,
                living_room: parseInt(document.getElementById('living_room').value),
                dining_room: parseInt(document.getElementById('dining_room').value),
                garden_area: parseFloat(document.getElementById('garden_area').value),
                parking_spaces: parseInt(document.getElementById('parking_spaces').value),
                balcony: false,
                front_direction: document.getElementById('front_direction').value,
                road_side: document.getElementById('road_side').value
            };

            const data = {
                land_input: landData,
                generations: parseInt(document.getElementById('generations').value),
                population_size: parseInt(document.getElementById('population_size').value),
                mutation_rate: 0.1,
                crossover_rate: 0.8
            };

            showLoading('optimizeResult');

            try {
                const response = await fetch(`${API_BASE}/api/v1/optimization/optimize?save_to_db=true`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('optimizeResult', result, response.ok);

                if (response.ok && result.visualization_url) {
                    const imgUrl = `${API_BASE}${result.visualization_url}`;
                    document.getElementById('floorPlan').innerHTML =
                        `<div style="max-width: 100%; overflow: hidden; border-radius: 8px; margin-top: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <img src="${imgUrl}" style="width: 100%; height: auto; display: block; object-fit: contain;" alt="Floor Plan" onerror="this.parentElement.innerHTML='<p style=padding:20px;text-align:center;color:#ef4444;>Failed to load visualization</p>'">
                        </div>`;
                }
            } catch (error) {
                showError('optimizeResult', error.message);
            }
        }

        // Load history
        async function loadHistory() {
            showLoading('historyResult');

            try {
                const response = await fetch(`${API_BASE}/api/v1/optimization/history?limit=10`);
                const result = await response.json();
                showResult('historyResult', result, response.ok);
            } catch (error) {
                showError('historyResult', error.message);
            }
        }

        // Load best
        async function loadBest() {
            showLoading('historyResult');

            try {
                const response = await fetch(`${API_BASE}/api/v1/optimization/best?limit=10&min_fitness=50`);
                const result = await response.json();
                showResult('historyResult', result, response.ok);
            } catch (error) {
                showError('historyResult', error.message);
            }
        }

        // Helper functions
        function showLoading(elementId) {
            const elem = document.getElementById(elementId);
            elem.style.display = 'block';
            elem.className = 'result';
            elem.innerHTML = '<div class="loading"></div> Processing...';
        }

        function showResult(elementId, data, success) {
            const elem = document.getElementById(elementId);
            elem.style.display = 'block';
            elem.className = success ? 'result success' : 'result error';
            elem.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        function showError(elementId, message) {
            const elem = document.getElementById(elementId);
            elem.style.display = 'block';
            elem.className = 'result error';
            elem.innerHTML = `<pre>Error: ${message}</pre>`;
        }
    </script>
</body>
</html>

<!-- Header updated -->